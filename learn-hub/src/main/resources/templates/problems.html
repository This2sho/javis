<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¬¸ì œ ëª©ë¡</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

<header>
    <h1>ë¬¸ì œ ê¸°ë¡</h1>
    <div class="header-actions">
        <button class="problem-addition-action"
                onclick="location.href='/review-requests'">
            ë¦¬ë·° ìƒíƒœ ë³´ê¸°
        </button>

        <button class="problem-addition-action"
                onclick="location.href='/problems/new'">
            + ìƒˆ ë¬¸ì œ ìƒì„±
        </button>
    </div>
</header>

<main class="page-container">
    <div id="problem-list" class="problem-list"></div>
    <div id="loading" class="interview-loading">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</main>

<!-- problem-form.jsëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ -->
<script src="/js/problem-form.js"></script>
<script src="/js/cursor-paging.js"></script>
<script>

    let loading = false;
    let hasNext = true;
    let nextCursor = null;

    const listEl = document.getElementById("problem-list");
    const loadingEl = document.getElementById("loading");

    async function loadProblems() {
        if (loading || !hasNext) return;
        loading = true;

        try {
            const data = await fetchCursorPage({
                url: "/api/problems",
                params: { size: 10 },
                cursor: nextCursor,
                credentials: "include"
            });

            renderProblems(data.items);

            hasNext = data.hasNext;
            nextCursor = data.nextCursor;

            if (!hasNext) {
                loadingEl.innerText = "ëª¨ë“  ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.";
            }
        } catch (e) {
            console.error(e);
            loadingEl.innerText = "ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨";
        } finally {
            loading = false;
        }
    }

    function renderProblems(problems) {
        problems.forEach(p => {
            const card = document.createElement("div");
            card.className = "problem-card";
            card.onclick = () => location.href = `/problems/${p.id}`;

            card.innerHTML = `
                <div class="problem-content">${p.content}</div>
                <div class="problem-meta">
                    <span class="tag difficulty">${p.difficulty}</span>
                    <span class="tag category">${p.category}</span>
                </div>
            `;

            listEl.appendChild(card);
        });
    }

    // ğŸ”¥ ìŠ¤í¬ë¡¤ í•˜ë‹¨ ê°ì§€
    window.addEventListener("scroll", () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
            loadProblems();
        }
    });

    // ìµœì´ˆ ë¡œë”©
    loadProblems();
</script>

</body>
</html>
