<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>인터뷰 기록</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

<header>
    <h1>인터뷰 기록</h1>
    <button onclick="location.href='/mypage'">마이페이지</button>
</header>

<div class="interview-list-container">
    <div id="interviewList"></div>
    <div id="loading" class="interview-loading">불러오는 중...</div>
</div>

<script src="/js/cursor-paging.js"></script>
<script>

    let loading = false;
    let hasNext = true;
    let nextCursor = null;

    const listEl = document.getElementById("interviewList");
    const loadingEl = document.getElementById("loading");

    async function loadInterviews() {
        if (loading || !hasNext) return;
        loading = true;

        try {
            const data = await fetchCursorPage({
                url: "/api/interviews",
                params: { size: 10 },
                cursor: nextCursor,
                credentials: "include"
            });

            data.items.forEach(item => {
                const div = document.createElement("div");
                div.className = "interview-item";
                div.onclick = () => {
                    location.href = `/interviews/${item.id}`;
                };

                div.innerHTML = `
                    <div class="interview-category">${item.categoryName}</div>
                    <div class="interview-date">${item.endedAt}</div>
                `;
                listEl.appendChild(div);
            });

            hasNext = data.hasNext;
            nextCursor = data.nextCursor;

            if (!hasNext) {
                loadingEl.innerText = "모든 기록을 불러왔습니다.";
            }
        } catch (err) {
            console.error(err);
            loadingEl.innerText = "불러오기 실패";
        } finally {
            loading = false;
        }
    }

    window.addEventListener("scroll", () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
            loadInterviews();
        }
    });

    loadInterviews();
</script>

</body>
</html>
